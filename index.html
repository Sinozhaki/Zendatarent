<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rent Linkedin By Zen - Card View (Data Only)</title>
  <!-- Memuat Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Menggunakan font Inter sebagai standar */
    body { 
        font-family: 'Inter', sans-serif; 
        
        /* --- BACKGROUND CUSTOM WALLPAPER --- */
        /* Ganti URL di bawah dengan 'Wallpaper.png' milik Anda */
        background-image: url('wallpaper.png');
        background-size: cover;
        background-attachment: fixed;
        background-position: center;
        min-height: 100vh;
    }
    
    /* --- GLASS MORPHISM EFFECT --- */
    .glass-card {
        /* Warna semi-transparan */
        background-color: rgba(255, 255, 255, 0.15); 
        /* Efek buram */
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px); /* Untuk Safari */
        /* Border halus */
        border: 1px solid rgba(255, 255, 255, 0.2); 
        /* Shadow untuk kedalaman */
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        color: #1f2937; /* Memastikan teks gelap (terlihat jelas) */
    }

    /* Konfigurasi warna status untuk aesthetic (Dibiarkan tetap) */
    .status-NewAcc { background-color: #d1fae5; color: #047857; } 
    .status-OldAcc { background-color: #fef3c7; color: #b45309; } 
    .status-Unrestric { background-color: #dbeafe; color: #1d4ed8; } 
    .status-Restric { background-color: #fee2e2; color: #dc2626; } 
    
    /* Menyesuaikan beberapa warna di dalam glass-card agar kontras */
    .glass-card .text-gray-500 { color: rgba(255, 255, 255, 0.9); }
    .glass-card .text-gray-900 { color: white; }
    .glass-card .text-gray-800 { color: white; }
    .glass-card .border-gray-100 { border-color: rgba(255, 255, 255, 0.1); }
  </style>
</head>
<body class="p-4 sm:p-8">
  <div class="max-w-5xl mx-auto">
    <!-- Header/Search Container dengan Glass Effect -->
    <div class="p-6 sm:p-8 rounded-2xl shadow-xl mb-8 glass-card">
      <h1 class="text-4xl font-extrabold text-white mb-2">Rent Linkedin By Zen</h1>

      <div class="mb-6 flex flex-col md:flex-row gap-4 items-end">
        
        <!-- Kolom Pencarian -->
        <div class="relative flex-grow w-full md:w-auto">
          <label for="searchInput" class="text-xs font-semibold text-white mb-1 block">Pencarian Email</label>
          <input 
            type="text" 
            id="searchInput" 
            placeholder="Cari email..." 
            class="w-full p-3 pl-10 border border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 bg-white bg-opacity-30 placeholder-gray-200 text-white"
            onkeyup="filterEmail()"
          >
          <!-- Ikon Pencarian -->
          <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 bottom-3 h-5 w-5 text-gray-200" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        </div>
        
        <!-- Kolom Status Indikator (Admin Login/Logout dipindahkan ke FAB) -->
        <div class="flex flex-shrink-0 gap-2 w-full md:w-auto items-center">
            <span id="adminStatus" class="font-medium text-red-300 flex-shrink-0 text-sm hidden">Mode Admin Tidak Aktif</span>
        </div>
      </div>
      
      <!-- Indikator Status Data -->
      <div id="statusIndicators" class="flex items-center gap-4 mt-2 md:mt-0 text-sm">
            <span id="loadingIndicator" class="text-indigo-300 font-semibold hidden animate-pulse">Memuat data...</span>
            <span id="errorIndicator" class="text-red-300 font-semibold hidden">Gagal memuat data!</span>
      </div>
    </div>

    <!-- Container untuk Card-Card Data -->
    <div id="dataContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Card-Card akan dimuat di sini -->
    </div>
    
    <!-- Indikator Data Kosong -->
    <div id="noDataMessage" class="hidden text-center py-20 glass-card rounded-2xl mt-8 p-8">
        <svg class="mx-auto h-12 w-12 text-gray-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
        <h3 class="mt-2 text-xl font-medium text-white">Tidak ada data</h3>
        <p class="mt-1 text-sm text-gray-300">Silakan coba kata kunci pencarian yang lain.</p>
    </div>

  </div>

  <!-- FAB (Floating Action Button) di Pojok Kiri Bawah -->
  <button id="adminFab" onclick="openAdminModal()" class="fixed bottom-6 left-6 z-50 p-4 bg-gray-800 text-white rounded-full shadow-xl hover:bg-indigo-600 transition duration-300 transform hover:scale-110">
      <!-- Gear/Kunci Icon -->
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 12h7"></path><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><path d="M17 15l-4-4V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v6l-4 4"></path></svg>
  </button>

  <!-- Admin Modal (Tersembunyi secara default) -->
  <div id="adminModal" class="hidden fixed inset-0 z-[60] bg-gray-900 bg-opacity-70 flex items-center justify-center p-4" onclick="closeAdminModalOutside(event)">
      <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm transform transition-all duration-300" onclick="event.stopPropagation()">
          <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center" id="modalTitle">Login Admin</h2>
          
          <!-- Status Admin di Modal -->
          <div id="modalAdminStatus" class="font-medium text-center text-red-500 mb-4 text-lg">Mode Admin Tidak Aktif</div>

          <!-- Login Form -->
          <div id="loginForm">
              <label for="modalAdminPasswordInput" class="text-sm font-medium text-gray-700 mb-2 block">Sandi Admin</label>
              <input 
                  type="password" 
                  id="modalAdminPasswordInput" 
                  placeholder="Masukkan sandi..." 
                  class="w-full p-3 border border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 mb-4"
                  onkeyup="if(event.key === 'Enter') checkAdminPassword()"
              >
              <p id="modalError" class="text-red-500 text-sm mb-4 hidden">Sandi salah!</p>
              <button 
                  id="modalAdminLoginButton" 
                  onclick="checkAdminPassword()"
                  class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-xl shadow-md transition duration-150"
              >
                  Login
              </button>
          </div>
          
          <!-- Logout Button (for Admin Mode) -->
          <div id="logoutSection" class="hidden">
              <p class="text-center text-gray-600 mb-4">Anda saat ini berada dalam **Mode Admin**.</p>
              <button 
                  id="modalAdminLogoutButton" 
                  onclick="logoutAdmin()"
                  class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 rounded-xl shadow-md transition duration-150"
              >
                  Keluar Mode Admin
              </button>
          </div>
          
          <button onclick="closeAdminModal()" class="mt-6 w-full text-sm text-gray-500 hover:text-gray-700 transition duration-150">Tutup Jendela</button>
      </div>
  </div>


  <script>
    // --- KONSTATA & VARIABEL PENTING ---
    const BIN_ID = '6905803fae596e708f3baa25';
    const API_KEY = '$2a$10$ziNrwiYaAO5/AfgfNP218OKOtjLxTV6c7Zau9vLmygY35FQ36jlci';
    const ADMIN_PASSWORD = '2003';
    
    let allData = [];
    let isAdminMode = false;
    
    // --- ELEMEN DOM ---
    const loadingEl = document.getElementById('loadingIndicator');
    const errorEl = document.getElementById('errorIndicator');
    const searchInputEl = document.getElementById('searchInput');
    const dataContainerEl = document.getElementById('dataContainer');
    const noDataMessageEl = document.getElementById('noDataMessage');
    
    // Elemen Admin Baru
    const adminFabEl = document.getElementById('adminFab');
    const adminModalEl = document.getElementById('adminModal');
    const modalTitleEl = document.getElementById('modalTitle');
    const modalAdminStatusEl = document.getElementById('modalAdminStatus');
    const modalAdminPasswordInputEl = document.getElementById('modalAdminPasswordInput');
    const loginFormEl = document.getElementById('loginForm');
    const logoutSectionEl = document.getElementById('logoutSection');
    const modalErrorEl = document.getElementById('modalError');

    // --- FUNGSI MODAL & TAMPILAN ADMIN ---
    
    /**
     * Memperbarui tampilan modal admin (login/logout form).
     */
    function updateAdminModalView() {
        if (isAdminMode) {
            modalTitleEl.textContent = 'Mode Admin Aktif';
            modalAdminStatusEl.textContent = 'Mode Admin Aktif';
            modalAdminStatusEl.classList.remove('text-red-500');
            modalAdminStatusEl.classList.add('text-green-600');
            loginFormEl.classList.add('hidden');
            logoutSectionEl.classList.remove('hidden');
        } else {
            modalTitleEl.textContent = 'Login Admin';
            modalAdminStatusEl.textContent = 'Mode Admin Tidak Aktif';
            modalAdminStatusEl.classList.add('text-red-500');
            modalAdminStatusEl.classList.remove('text-green-600');
            loginFormEl.classList.remove('hidden');
            logoutSectionEl.classList.add('hidden');
            modalAdminPasswordInputEl.value = ''; // Kosongkan input
            modalErrorEl.classList.add('hidden');
        }
        modalAdminStatusEl.classList.remove('hidden');
    }
    
    /**
     * Membuka modal admin dan memperbarui tampilannya.
     */
    function openAdminModal() {
        updateAdminModalView();
        adminModalEl.classList.remove('hidden');
    }

    /**
     * Menutup modal admin.
     */
    function closeAdminModal() {
        adminModalEl.classList.add('hidden');
    }
    
    /**
     * Menutup modal jika klik di luar area modal.
     */
    function closeAdminModalOutside(event) {
        if (event.target === adminModalEl) {
            closeAdminModal();
        }
    }


    /**
     * Memeriksa sandi dan mengaktifkan mode admin.
     */
    function checkAdminPassword() {
      const password = modalAdminPasswordInputEl.value.trim();
      modalErrorEl.classList.add('hidden'); // Sembunyikan pesan error

      if (password === ADMIN_PASSWORD) {
        isAdminMode = true;
        
        // Perbarui tampilan modal dan status global
        updateAdminModalView();
        
        // Re-render untuk mengaktifkan kolom edit dan menampilkan WA
        renderCards(allData);
        
        // Tutup modal setelah login berhasil (opsional)
        // closeAdminModal(); 

      } else {
        modalErrorEl.textContent = 'Sandi salah!';
        modalErrorEl.classList.remove('hidden');
        modalAdminPasswordInputEl.value = ''; 
      }
    }

    /**
     * Menonaktifkan mode admin dan mereset tampilan.
     */
    function logoutAdmin() {
        isAdminMode = false;
        
        // Perbarui tampilan modal dan status global
        updateAdminModalView();
        
        // Re-render kartu untuk mode pengguna biasa
        renderCards(allData); 
        
        closeAdminModal(); // Tutup modal setelah logout
        console.log('Mode Admin telah dinonaktifkan.');
    }


    /**
     * Mengirim seluruh data yang diperbarui kembali ke JSON Bin (PUT request).
     */
    async function updateJsonBin(data) {
        // Tampilkan loading saat menyimpan di indikator global
        loadingEl.textContent = 'Menyimpan data...';
        loadingEl.classList.remove('hidden');
        errorEl.classList.add('hidden');

        try {
            const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Master-Key': API_KEY,
                    'X-Bin-Versioning': 'false' 
                },
                body: JSON.stringify(data)
            });

            if (!res.ok) {
                const errorBody = await res.json().catch(() => ({ message: 'Error unknown' }));
                throw new Error(`Gagal menyimpan data: ${res.status} - ${errorBody.message || 'Respons API tidak valid.'}`);
            }
            
            console.log('Catatan berhasil disimpan ke JSON Bin.');
            return true;

        } catch (error) {
            console.error('Error updating data:', error);
            errorEl.textContent = `Gagal menyimpan: ${error.message}`;
            errorEl.classList.remove('hidden');
            return false;
        } finally {
            loadingEl.classList.add('hidden');
            loadingEl.textContent = 'Memuat data...'; // Reset pesan loading
            setTimeout(() => errorEl.classList.add('hidden'), 5000); 
        }
    }

    /**
     * Menyimpan catatan dari input admin ke array lokal dan JSON Bin.
     */
    async function saveNote(event) {
        if (!isAdminMode) {
            console.warn("Aksi ditolak: Bukan Mode Admin.");
            return;
        }
        
        const button = event.currentTarget;
        const index = parseInt(button.dataset.index, 16); 

        if (isNaN(index) || index < 0 || index >= allData.length) {
            console.error("Index data tidak valid.");
            return;
        }

        const noteTextarea = document.getElementById(`note-${index}`);
        const newNote = noteTextarea.value.trim();

        // 1. Update data lokal
        allData[index].note = newNote;

        // 2. Simpan seluruh array yang sudah di-update ke JSON Bin
        const originalText = button.textContent;
        button.textContent = 'Menyimpan...';
        button.disabled = true;

        const success = await updateJsonBin(allData);

        if (success) {
            button.textContent = 'Berhasil Disimpan!';
            button.classList.replace('bg-indigo-600', 'bg-green-600');
            button.classList.replace('hover:bg-indigo-700', 'hover:bg-green-700');
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.replace('bg-green-600', 'bg-indigo-600');
                button.classList.replace('hover:bg-green-700', 'hover:bg-indigo-700');
                button.disabled = false;
            }, 2000);
        } else {
            button.textContent = 'Gagal Menyimpan!';
            button.classList.replace('bg-indigo-600', 'bg-red-600');
            button.classList.replace('hover:bg-indigo-700', 'hover:bg-red-700');
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.replace('bg-red-600', 'bg-indigo-600');
                button.classList.replace('hover:bg-red-700', 'hover:bg-indigo-700');
                button.disabled = false;
            }, 3000);
        }
    }


    // --- FUNGSI DATA DAN RENDER ---

    /**
     * Mengurutkan data berdasarkan status dengan urutan yang ditentukan.
     */
    function sortByStatus(data) {
      const order = { 'New Acc': 1, 'Old Acc': 2, 'Unrestric': 3, 'Restric': 4 };
      return data.sort((a, b) => {
        const statusA = a.status || 'New Acc';
        const statusB = b.status || 'New Acc';
        return (order[statusA] || 99) - (order[statusB] || 99);
      });
    }

    /**
     * Merender (menampilkan) data ke dalam tata letak card.
     */
    function renderCards(data) {
      dataContainerEl.innerHTML = '';
      
      if (data.length === 0) {
        noDataMessageEl.classList.remove('hidden');
        return;
      }

      noDataMessageEl.classList.add('hidden');

      data.forEach((item, index) => {
        const email = item.email || 'N/A';
        let wa = item.wa || item.whatsapp || item.phone || 'N/A';
        
        // Format nomor WA (dari 0 ke +62)
        if (wa.startsWith('0')) { wa = '+62' + wa.substring(1); } 
        else if (wa && wa !== 'N/A' && !wa.startsWith('+')) { wa = '+62' + wa; }
        
        const displayWa = wa; // Hanya digunakan di Mode Admin
        
        const defaultDate = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
        const tanggal = item.tanggal || defaultDate;
        const status = item.status || 'New Acc';
        const note = item.note || ''; // Ambil catatan

        const statusClass = `status-${status.replace(/\s/g, '')}`;
        const dataIndexHex = index.toString(16);

        // --- Konten Catatan (berubah berdasarkan mode admin) ---
        let noteContentHtml = '';
        let footerHtml = '';
        let waDetailHtml = '';

        if (isAdminMode) {
            // Tampilkan No. WA hanya di Mode Admin
            waDetailHtml = `
              <div class="flex justify-between items-center text-sm">
                <span class="font-medium text-gray-500">No. WA:</span>
                <span class="text-white font-mono">${displayWa}</span>
              </div>
            `;
            
            // Tampilkan Catatan yang dapat diedit di Mode Admin
            noteContentHtml = `
                <div class="space-y-1 pt-3 border-t border-gray-100">
                    <label for="note-${index}" class="font-medium text-gray-500 block text-sm">Catatan Admin:</label>
                    <textarea 
                        id="note-${index}" 
                        class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 text-gray-900 bg-white" 
                        rows="2" 
                        placeholder="Tambahkan catatan..."
                    >${note}</textarea>
                </div>
            `;
            footerHtml = `
                <div class="p-4 bg-transparent border-t border-gray-100">
                    <button 
                        data-index="${dataIndexHex}" 
                        onclick="saveNote(event)"
                        class="w-full inline-flex items-center justify-center p-2 rounded-lg text-white font-semibold text-sm shadow-md bg-indigo-600 hover:bg-indigo-700 transition duration-150"
                    >
                        Simpan Catatan
                    </button>
                </div>
            `;
        } else {
            // Mode Pengguna Biasa: Sembunyikan No. WA
            waDetailHtml = ''; 
            
            // Tampilkan Catatan Read-only
            noteContentHtml = `
                <div class="flex flex-col items-start text-sm pt-3 border-t border-gray-100">
                    <span class="font-medium text-gray-500 mb-1">Catatan Admin:</span>
                    <span class="text-white text-sm italic w-full whitespace-pre-wrap">${note || '— Tidak ada catatan —'}</span>
                </div>
            `;
            // Footer kosong
            footerHtml = `
                <div class="p-2 bg-transparent border-t border-gray-100"></div>
            `;
        }


        // Struktur Card dengan Glass Effect
        const cardHtml = `
          <div class="rounded-xl shadow-lg hover:shadow-2xl transition duration-300 transform hover:scale-[1.02] border border-gray-200 overflow-hidden glass-card">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center">
              <h3 class="text-xl font-bold text-white truncate">${email}</h3>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold ${statusClass}">
                ${status}
              </span>
            </div>
            
            <div class="p-5 space-y-3">
              <!-- Detail Tanggal -->
              <div class="flex justify-between items-center text-sm">
                <span class="font-medium text-gray-500">Tanggal:</span>
                <span class="text-white">${tanggal}</span>
              </div>

              <!-- Detail WhatsApp (Hanya tampil di Mode Admin) -->
              ${waDetailHtml}

              <!-- Catatan -->
              ${noteContentHtml}
            </div>

            <!-- Footer Card (Hanya tombol simpan di Mode Admin) -->
            ${footerHtml}
          </div>
        `;
        dataContainerEl.innerHTML += cardHtml;
      });
    }

    /**
     * Mengambil data dari JSON Bin.
     */
    async function fetchData() {
      loadingEl.classList.remove('hidden');
      errorEl.classList.add('hidden');
      dataContainerEl.innerHTML = ''; 

      try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { 
          headers: { 'X-Master-Key': API_KEY }
        });
        
        if (!res.ok) {
            throw new Error(`API returned status ${res.status}`);
        }

        const json = await res.json();
        let data = json.record || [];
        
        if (!Array.isArray(data)) { data = [data]; }

        allData = sortByStatus(data);
        renderCards(allData);

      } catch (error) {
        console.error('Error fetching data:', error);
        errorEl.classList.remove('hidden');
        dataContainerEl.innerHTML = `
            <div class="col-span-full text-center py-10 glass-card rounded-xl border border-red-200">
                <p class="text-red-300 font-semibold">Gagal mengambil data dari JSON Bin.</p>
                <p class="text-red-400 text-sm">Cek BIN_ID atau API_KEY Anda. (${error.message})</p>
            </div>
        `;
        noDataMessageEl.classList.add('hidden');
      } finally {
        loadingEl.classList.add('hidden');
      }
    }

    /**
     * Menyaring data berdasarkan input pencarian email.
     */
    function filterEmail() {
      const keyword = searchInputEl.value.toLowerCase().trim();
      const filtered = allData.filter(item => (item.email || '').toLowerCase().includes(keyword));
      renderCards(filtered);
    }
    
    // --- INISIALISASI ---
    document.addEventListener('DOMContentLoaded', () => {
        fetchData();
        
        // Memastikan fungsi dapat diakses secara global
        window.checkAdminPassword = checkAdminPassword;
        window.saveNote = saveNote;
        window.logoutAdmin = logoutAdmin; 
        window.openAdminModal = openAdminModal;
        window.closeAdminModal = closeAdminModal;
        window.closeAdminModalOutside = closeAdminModalOutside;
        window.filterEmail = filterEmail;
    });
  </script>
</body>
</html>
